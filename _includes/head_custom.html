<!-- Dark Mode Support with System Preference Detection -->
<script>
  // Check for saved preference, otherwise use system preference
  const getPreferredTheme = () => {
    const saved = localStorage.getItem("theme");
    if (saved) return saved;
    return window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
  };

  // Apply theme immediately to prevent flash
  const theme = getPreferredTheme();
  if (theme === "dark") {
    document.documentElement.setAttribute("data-theme", "dark");
  }
</script>

<style>
  /* Dark mode color overrides using CSS custom properties */
  :root[data-theme="dark"] {
    --body-background-color: #1e1e1e;
    --sidebar-color: #262626;
    --body-text-color: #e0e0e0;
    --body-heading-color: #ffffff;
    --link-color: #79b8ff;
    --nav-child-link-color: #b0b0b0;
    --search-background-color: #333333;
    --search-result-preview-color: #c0c0c0;
    --code-background-color: #2d2d2d;
    --border-color: #404040;
    --table-background-color: #262626;
    --feedback-color: rgba(255, 255, 255, 0.1);
  }

  /* Theme toggle button styles */
  .theme-toggle {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: 2px solid var(--border-color, #e0e0e0);
    background: var(--body-background-color, #ffffff);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    z-index: 1000;
    transition:
      transform 0.2s,
      background 0.3s;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }

  .theme-toggle:hover {
    transform: scale(1.1);
  }

  .theme-toggle .icon-sun,
  .theme-toggle .icon-moon {
    display: none;
  }

  /* Show sun in dark mode (to switch to light) */
  :root[data-theme="dark"] .theme-toggle .icon-sun {
    display: block;
  }

  /* Show moon in light mode (to switch to dark) */
  :root:not([data-theme="dark"]) .theme-toggle .icon-moon {
    display: block;
  }
</style>
